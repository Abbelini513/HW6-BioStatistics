---
title: "Homework 6 BioStat"
author: "Bondareva Alina Kirillovna"
date: "2024-04-17"
output: html_document
---

# Домашнее задание 6

#### Выполнила Бондарева Алина Кирилловна

### **Тема:** расчет выборки при планировании исследования.

### **Цель:** научиться рассчитывать выборку для исследований с различными конечными точками

## **Описание ДЗ:**

*При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.*

*Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.*

## **Задание №1**

*Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% (*$\sigma_m = 0.20$), а разница средних составляет −10% ($\epsilon = \mu_{\text{test}} - \mu_{\text{reference}}$). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ($\delta = 0.25$).

Воспользуйтесь следующей формулой:

$n_1 = n_2 = \frac{(Z_{\alpha/2} \pm Z_{\beta})^2 \sigma_m^2}{2*(\delta - |\epsilon|)^2}, \quad n = n_1 + n_2$

## **Решение**

Сначала зададим значения:

```{r, include=TRUE}
# Установка значений
alpha <- 0.05 # Уровень значимости 5%
beta <- 0.20 # Ошибка второго рода (1 - мощность(100%-80%) = бета)
sigma_m <- 0.20 # Дисперсия 20%
delta <- 0.25 # Клинически значимая разница 25%
epsilon <- -0.10 # Разница средних -10%
drop_out_rate <- 0.10 # Ожидаемый drop-out rate 10%

# Расчет квантилей нормального распределения
## Находим z_alpha/2 (квантиль нормального распределения для уровня значимости alpha/2)
z_alpha_na_2 <- abs(qnorm(1 - alpha / 2))
## # Находим z_beta (квантиль нормального распределения для ошибки второго рода (бета))
z_beta <- abs(qnorm(beta))

# Посмотрим на результат
z_alpha_na_2
z_beta

```

Произведем расчеты по формуле из задания:

```{r, include=TRUE}
# Расчет размера выборки без учета drop-out rate
n <- (z_alpha_na_2 + z_beta)^2 * sigma_m^2 / (2 * (delta - abs(epsilon))^2)

# Корректировка размера выборки с учетом drop-out rate
n_adjusted <- n / (1 - drop_out_rate)

# Округляем в большую сторону
n_for_one_group <- ceiling(n_adjusted)

# Вывод результатов
cat("Необходимый размер выборки для каждой группы (без учета drop-out rate):", round(n), "\n")
cat("Скорректированный размер выборки для каждой группы (с учетом drop-out rate):", round(n_for_one_group), "\n")
cat("Общий размер выборки (с учетом drop-out rate):", round(n_for_one_group * 2), "\n") # умножаем на 2, так как n1 = n2

```

## **Задание №2**

*Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница* $\sigma_m2$ = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата $p_2$ = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет $p_1$ = 0.85. Соотношение групп равно $k$ = 1.

Воспользуйтесь следующей формулой:

$n_1 = n_2 = \frac{(Z_{\alpha/2} + Z_{\beta})^2 \left( p_1(1-p_1) + p_2(1-p_2) \right)}{(p_1 - p_2 - \delta)^2}, \quad n = n_1 + n_2$

## **Решение**

```{r, include=TRUE}
# Клинически значимая разница
sigma_m2 <- abs(-0.1)
# Доля ответов для препаратов
p_1 <- 0.85
p_2 <- 0.65

# Расчет квантилей нормального распределения
z_alpha_na_2_2 <- abs(qnorm(1 - alpha / 2))
z_beta2 <- abs(qnorm(1 - beta))

# Расчет размера выборки для каждой группы
n1_n2 <- ((z_alpha_na_2_2 + z_beta2)^2 * (p_1 * (1 - p_1) + p_2 * (1 - p_2))) / (p_1 - p_2 - delta)^2

# Учитываем drop-out rate
n1_n2_with_dropout <- n1_n2 / (1 - drop_out_rate)

# Округляем в большую сторону
n1_n2_for_one_group <- ceiling(n1_n2_with_dropout)
n_total_sample_size <- n1_n2_for_one_group * 2

# Вывод результатов
cat("Необходимый размер выборки для каждой группы:", n1_n2_for_one_group, "\n")
cat("Общий размер выборки:", n_total_sample_size, "\n")
```

## **Задание №3**

*Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ($d$ = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ($p_1 = p_2 = 0.5$).*

Воспользуйтесь следующей формулой:

$n_1 = n_2 = \frac{(Z_{\alpha/2} + Z_{\beta})^2}{\ln(HR)^2 p_1 p_2 d^2}, \quad n = n_1 + n_2$

## **Решение**

```{r,include=TRUE}
# Отношение рисков
HR <- 2
# Процент пациентов d
d <- 0.8
# Соотношение групп
p1 <- 0.5
p2 <- 0.5

# Расчет квантилей нормального распределения
z_alpha_na_2_3 <- abs(qnorm(1 - alpha / 2))
z_beta3 <- abs(qnorm(1 - beta))

# Расчет размера выборки для каждой группы
n_1_n_2 <- (z_alpha_na_2_3 + z_beta3)^2 / (log(HR)^2 * p1 * p2 * d)

# Учитываем drop-out rate
n_1_n_2_with_dropout <- n_1_n_2 / (1 - drop_out_rate)

# Округляем в большую сторону
n_1_n_2_for_one_group <- ceiling(n_1_n_2_with_dropout)
n_1_n_2_total_sample_size <- n_1_n_2_for_one_group * 2

# Вывод результатов
cat("Необходимый размер выборки для каждой группы:", n_1_n_2_for_one_group, "\n")
cat("Общий размер выборки:", n_1_n_2_total_sample_size, "\n")
```

